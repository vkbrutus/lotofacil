<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <title>Lotof√°cil v3</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Adicionar verifica√ß√£o de carregamento -->
    <script>
        // Prevenir p√°gina em branco
        window.addEventListener('DOMContentLoaded', function() {
            console.log('P√°gina carregada com sucesso!');
            document.body.style.opacity = '1';
        });
        
        // Timeout de seguran√ßa
        setTimeout(function() {
            if (document.readyState !== 'complete') {
                console.warn('Carregamento lento detectado');
                document.body.style.opacity = '1';
            }
        }, 3000);
    </script>
    
    <style>
        /* Prevenir flash de conte√∫do */
        body {
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        /* Loading inicial */
        .initial-loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0f172a;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            flex-direction: column;
            gap: 1rem;
        }
        
        .loader-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #334155;
            border-top-color: #10b981;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        .loader-text {
            color: #94a3b8;
            font-family: system-ui, -apple-system, sans-serif;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Estilos originais */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: system-ui, -apple-system, sans-serif; 
            background: #0f172a; 
            color: #f1f5f9; 
            min-height: 100vh; 
        }
        
        /* Mensagem de erro amig√°vel */
        .error-container {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #1e293b;
            border: 2px solid #ef4444;
            border-radius: 12px;
            padding: 2rem;
            max-width: 500px;
            text-align: center;
            z-index: 10000;
        }
        
        .error-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        .error-title {
            font-size: 1.5rem;
            color: #ef4444;
            margin-bottom: 1rem;
        }
        
        .error-message {
            color: #94a3b8;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }
        
        .error-btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .error-btn:hover {
            background: #059669;
        }
    </style>
</head>
<body>
    <!-- Loader inicial -->
    <div class="initial-loader" id="initialLoader">
        <div class="loader-spinner"></div>
        <div class="loader-text">Carregando Lotof√°cil v3...</div>
    </div>
    
    <!-- Mensagem de erro -->
    <div class="error-container" id="errorContainer">
        <div class="error-icon">‚ö†Ô∏è</div>
        <div class="error-title">Erro ao Carregar</div>
        <div class="error-message" id="errorMessage">
            N√£o foi poss√≠vel carregar o aplicativo. Verifique sua conex√£o com a internet.
        </div>
        <button class="error-btn" onclick="location.reload()">Tentar Novamente</button>
    </div>
    
    <script>
        // Sistema de verifica√ß√£o e diagn√≥stico
        (function() {
            let loadTimeout;
            let checksPassed = {
                dom: false,
                scripts: false,
                styles: false
            };
            
            // Verificar DOM
            document.addEventListener('DOMContentLoaded', function() {
                checksPassed.dom = true;
                console.log('‚úì DOM carregado');
                checkLoadComplete();
            });
            
            // Verificar scripts externos
            function checkExternalScripts() {
                if (typeof XLSX !== 'undefined' && typeof Chart !== 'undefined') {
                    checksPassed.scripts = true;
                    console.log('‚úì Scripts externos carregados');
                    checkLoadComplete();
                } else {
                    console.warn('‚ö† Aguardando scripts externos...');
                    setTimeout(checkExternalScripts, 500);
                }
            }
            
            setTimeout(checkExternalScripts, 100);
            
            // Verificar se tudo carregou
            function checkLoadComplete() {
                if (checksPassed.dom && checksPassed.scripts) {
                    hideLoader();
                }
            }
            
            // Esconder loader
            function hideLoader() {
                const loader = document.getElementById('initialLoader');
                if (loader) {
                    loader.style.display = 'none';
                }
                document.body.style.opacity = '1';
                console.log('‚úì Aplicativo carregado com sucesso');
            }
            
            // Timeout de seguran√ßa - 10 segundos
            loadTimeout = setTimeout(function() {
                if (!checksPassed.dom || !checksPassed.scripts) {
                    showError('Tempo limite de carregamento excedido. Alguns recursos podem n√£o estar dispon√≠veis.');
                    hideLoader();
                }
            }, 10000);
            
            // Mostrar erro
            window.showError = function(message) {
                const errorContainer = document.getElementById('errorContainer');
                const errorMessage = document.getElementById('errorMessage');
                if (errorContainer && errorMessage) {
                    errorMessage.textContent = message;
                    errorContainer.style.display = 'block';
                }
            };
            
            // Capturar erros globais
            window.addEventListener('error', function(e) {
                console.error('Erro detectado:', e.message);
            });
            
            // Verificar APIs
            window.testAPIs = function() {
                console.log('üîç Testando conectividade das APIs...');
                
                fetch('https://loteriascaixa-api.herokuapp.com/api/lotofacil/latest')
                    .then(r => {
                        if (r.ok) {
                            console.log('‚úì API Principal: OK');
                        } else {
                            console.warn('‚ö† API Principal: Erro ' + r.status);
                        }
                    })
                    .catch(e => {
                        console.error('‚úó API Principal: Falha - ' + e.message);
                    });
            };
        })();
    </script>
    
    <noscript>
        <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #1e293b; padding: 2rem; border-radius: 12px; text-align: center; border: 2px solid #ef4444;">
            <h2 style="color: #ef4444; margin-bottom: 1rem;">JavaScript Desabilitado</h2>
            <p style="color: #94a3b8;">Este aplicativo requer JavaScript para funcionar. Por favor, habilite o JavaScript no seu navegador.</p>
        </div>
    </noscript>
    
    <h1 style="text-align: center; margin-top: 20vh; color: #10b981; font-size: 2rem;">
        üçÄ VKBRUTUS LOTERIAS
    </h1>
    <p style="text-align: center; color: #94a3b8; margin-top: 1rem;">
        Sistema de an√°lise da Lotof√°cil v3
    </p>
    <p style="text-align: center; color: #64748b; margin-top: 0.5rem; font-size: 0.9rem;">
        Vers√£o otimizada para Vercel
    </p>
    
</body>
</html>
